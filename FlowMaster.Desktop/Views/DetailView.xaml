<UserControl x:Class="FlowMaster.Desktop.Views.DetailView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:vm="clr-namespace:FlowMaster.Desktop.ViewModels"
             d:DataContext="{d:DesignInstance Type=vm:DetailViewModel}"
             mc:Ignorable="d" 
             d:DesignHeight="600" d:DesignWidth="800">
    <UserControl.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVis"/>
    </UserControl.Resources>
    
    <Grid Margin="30">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/> <!-- Header -->
            <RowDefinition Height="Auto"/> <!-- Status Info -->
            <RowDefinition Height="*"/>    <!-- Test Results -->
            <RowDefinition Height="Auto"/> <!-- Action Buttons -->
        </Grid.RowDefinitions>

        <!-- 1. Header with Back Button -->
        <DockPanel Grid.Row="0" Margin="0,0,0,20">
            <Button DockPanel.Dock="Left" Command="{Binding BackCommand}" Content="← Back" 
                    Margin="0,0,20,0" Padding="10,5" Background="Transparent" BorderThickness="0"/>
            <TextBlock Text="{Binding Document.Title}" FontSize="24" FontWeight="Bold" Foreground="#002c5f"/>
        </DockPanel>

        <!-- 2. Info -->
        <StackPanel Grid.Row="1" Margin="0,0,0,20">
             <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                 <TextBlock Text="작성자: " FontWeight="Bold"/>
                 <TextBlock Text="{Binding Document.WriterName}" Margin="5,0,20,0"/>
                 <TextBlock Text="작성일: " FontWeight="Bold"/>
                 <TextBlock Text="{Binding Document.CreateDate, StringFormat=yyyy-MM-dd HH:mm}" Margin="5,0,20,0"/>
                 <TextBlock Text="상태: " FontWeight="Bold"/>
                 <TextBlock Text="{Binding Document.Status}" Margin="5,0,20,0" Foreground="#002c5f"/>
             </StackPanel>
        </StackPanel>

        <!-- 3. Test Results -->
        <DataGrid Grid.Row="2" ItemsSource="{Binding Document.TestResults}" AutoGenerateColumns="False" IsReadOnly="True"
                  Background="White" BorderBrush="#e4dcd3" BorderThickness="1">
            <DataGrid.Columns>
                <DataGridTextColumn Header="프로젝트" Binding="{Binding ProjectName}" Width="150"/>
                <DataGridTextColumn Header="버전" Binding="{Binding Version}" Width="80"/>
                <DataGridTextColumn Header="테스트명" Binding="{Binding TestCaseName}" Width="150"/>
                <DataGridCheckBoxColumn Header="성공" Binding="{Binding IsPass}" Width="50"/>
                <DataGridTextColumn Header="실패사유" Binding="{Binding FailureReason}" Width="*"/>
            </DataGrid.Columns>
        </DataGrid>

        <!-- 4. Approval Actions (Visible only if CanApprove) -->
        <StackPanel Grid.Row="3" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,20,0,0"
                    Visibility="{Binding CanApprove, Converter={StaticResource BoolToVis}}">
            <Button Content="반려 (Reject)" Command="{Binding RejectCommand}" 
                    Background="#cc0000" Foreground="White" Padding="20,10" Margin="0,0,10,0"/>
            <Button Content="승인 (Approve)" Command="{Binding ApproveCommand}" 
                    Background="#002c5f" Foreground="White" Padding="20,10"/>
        </StackPanel>
    </Grid>
</UserControl>
